# zsh-ai Development Roadmap

프로젝트 분석 및 향후 개선 사항을 정리한 로드맵입니다.

---

## 🎯 완료된 항목 (Phase 1-2)

### Phase 1: Security Fixes ✅
- [x] **API 키 노출 방지**: curl 명령어에서 API 키를 임시 파일로 전달하도록 변경
- [x] **임시 파일 보안**: mktemp 사용 시 명시적으로 chmod 600 설정
- [x] **.env 파일 권한 검증**: .env 파일 로드 시 권한 체크 (600/400 권장)

### Phase 2: Code Quality ✅
- [x] **중복 코드 제거**: JSON 파싱 로직을 공통 함수로 통합 (~160줄 감소)
- [x] **설정값 커스터마이징**: max_tokens, temperature를 환경변수로 설정 가능하게 변경
- [x] **에러 메시지 표준화**: 일관된 `Error: [provider] message` 형식 적용
- [x] **Ollama num_predict 추가**: Ollama provider에 토큰 제한 파라미터 추가

---

## 🔴 높은 우선순위 (버그/문제점)

### 1. 에러 처리 개선
**현재 문제**:
- curl 실패 시 네트워크 오류, 타임아웃, HTTP 에러를 구분하지 않음
- JSON 파싱 실패 시 무응답 또는 빈 문자열 반환
- Ollama 서버 체크 실패 시 사용자 안내 부족

**개선 방안**:
- Ollama의 `_zsh_ai_check_ollama()` 패턴을 다른 provider에도 적용
- curl exit code별 상세한 에러 메시지 제공
- API 응답 HTTP 상태 코드 체크 및 분류

### 2. 안전 기능
**현재 문제**:
- 위험한 명령어 생성 시 경고 없음
- sudo 명령어 확인 절차 없음

**개선 방안**:
- 위험 패턴 검사 추가: `rm -rf /`, `dd if=`, `chmod 777`, `> /dev/sd*`, `mkfs`
- sudo 포함 명령어 생성 시 추가 확인 프롬프트
- 실행 전 명령어 미리보기 옵션

---

## 🟡 중간 우선순위 (보완 필요)

### 1. 컨텍스트 감지 확장
**현재 상태**:
- 기본적인 프로젝트 타입 감지 (Python, Rust, Go, Node.js 등)
- git 정보 수집
- OS/shell 정보 제공

**개선 방안**:
- 프로젝트 타입 추가: Kotlin, Swift, C/C++, Scala, Elixir
- 패키지 매니저 구분: npm, yarn, pnpm, pip, cargo, composer
- 가상환경 감지: Python venv, conda, Ruby rbenv

### 2. 설정 검증
**현재 문제**:
- 모델명 검증 없음 → API 에러로만 확인 가능
- URL 형식 검증 없음
- ZSH 버전 체크 없음

**개선 방안**:
- `_zsh_ai_validate_config()` 강화
- 모델명 whitelist 또는 pattern matching
- URL 형식 검증 (http/https)
- ZSH 5.0+ 버전 체크

### 3. 문서화
**필요 항목**:
- 에러 메시지별 대처 방법 문서화
- 프로바이더별 제한사항 (rate limit, 모델 특성)
- 트러블슈팅 가이드
- API 키 보안 설정 가이드

---

## 🟢 낮은 우선순위 (개선 사항)

### 1. 성능 최적화
**현재 문제**:
- 매 요청마다 컨텍스트 재수집 (git status, file list)
- jq 존재 여부 매번 확인

**개선 방안**:
- 컨텍스트 캐싱 (git 상태 변경 감지)
- jq 존재 여부를 초기화 시 한 번만 확인
- git 명령어 호출 최적화 (3회 → 1회)

### 2. 사용자 경험
**개선 방안**:
- 로딩 애니메이션 개선 (프롬프트 옆 표시)
- 컬러 설정 커스터마이징
- 명령어 생성 후 자동 실행 옵션 (위험!)

### 3. 코드 품질
**개선 방안**:
- 함수 내 local 키워드 일관성 체크
- 하드코딩된 API 버전 정보 변수화 (anthropic-version 등)
- curl 옵션 호환성 체크

---

## 🔵 향후 추가 기능

### 1. 핵심 기능
- [ ] **히스토리 기능**: 이전 생성 명령어 조회/재사용
- [ ] **명령어 설명 모드**: 생성된 명령어 설명 (현재 --e 플래그로 부분 지원)
- [ ] **다중 명령어 제안**: 여러 대안 제시
- [ ] **명령어 수정 요청**: "좀 더 간단하게", "파일만" 등 후속 요청

### 2. 프로바이더 확장
- [ ] **AWS Bedrock**: 기업 환경
- [ ] **Azure OpenAI**: 기업용 OpenAI
- [ ] **Groq**: 빠른 추론 속도
- [ ] **로컬 LLM**: llama.cpp, vLLM 등

### 3. 편의 기능
- [ ] **오프라인 모드**: 자주 사용하는 패턴 캐싱
- [ ] **명령어 북마크**: 유용한 명령어 저장
- [ ] **커스텀 별칭**: 자주 쓰는 쿼리에 별칭
- [ ] **자동 완성 통합**: zsh completion 연동

### 4. 분석/로깅
- [ ] **사용 통계**: 프로바이더별 호출 횟수, 성공률
- [ ] **응답 시간 로깅**: 느린 응답 디버깅
- [ ] **비용 추정**: API 호출 비용 표시

### 5. 테스트
- [ ] **자동화된 테스트**: 단위 테스트, 통합 테스트
- [ ] **Mock 프로바이더**: 테스트용 더미 프로바이더
- [ ] **CI/CD 통합**: GitHub Actions 등

---

## 📋 우선순위 요약

| 우선순위 | 항목                      | 상태      | 예상 시간  |
|------|-------------------------|---------|--------|
| ✅    | API 키 보안 개선             | **완료**  | -      |
| ✅    | temperature/max_tokens  | **완료**  | -      |
| ✅    | 코드 중복 제거               | **완료**  | -      |
| 🔴   | 에러 처리 개선               | 계획 중    | 3-4시간  |
| 🔴   | 위험 명령어 경고              | 계획 중    | 2시간    |
| 🟡   | 컨텍스트 감지 확장             | -       | 4-5시간  |
| 🟡   | 설정 검증 강화               | -       | 2-3시간  |
| 🟡   | 문서화                    | -       | 2-3시간  |
| 🟢   | 성능 최적화                 | -       | 2-3시간  |
| 🔵   | 히스토리 기능                | -       | 5-6시간  |
| 🔵   | 추가 프로바이더               | -       | 각 2-3시간 |

---

## 📝 업데이트 이력
- 2025-01-XX: Phase 1 (보안 수정) 완료
- 2025-01-XX: Phase 2 (코드 품질) 완료
- 2025-01-XX: ROADMAP.md 생성
